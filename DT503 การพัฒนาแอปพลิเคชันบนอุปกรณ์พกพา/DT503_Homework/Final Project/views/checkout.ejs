<!DOCTYPE html>
<html lang="th" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      http-equiv="Cache-Control"
      content="no-store, no-cache, must-revalidate, max-age=0"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>NJTK Bookstore</title>

    <link rel="icon" type="image/png" href="/images/NJTK_Logo_small.png" />

    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- CSS -->
    <link rel="stylesheet" href="/stylesheets/styles.css" />
    <link rel="stylesheet" href="/stylesheets/cardBook.css" />
    <link rel="stylesheet" href="/stylesheets/scrollbar.css" />

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;400;500;700&family=Noto+Sans+Thai:wght@300;400;600&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "theme-sage": "#809671" /* Primary: เขียวใบไม้ */,
              "theme-olive": "#B3B792" /* Secondary: เขียวมะกอก/ทอง */,
              "theme-cream": "#E5E0D8" /* Background: สีครีมกระดาษ */,
              "theme-charcoal": "#2A3328" /* Text: สีเทาเข้มอมเขียว */,
              "theme-paper": "#F5F3EF" /* Card: สีขาวนวล */,
            },
            fontFamily: {
              playfair: ['"Playfair Display"', "serif"],
              sans: ['"DM Sans"', '"Noto Sans Thai"', "sans-serif"],
            },
            boxShadow: {
              soft: "0 10px 40px -10px rgba(0,0,0,0.08)",
              glass: "0 8px 32px 0 rgba(31, 38, 135, 0.07)",
            },
          },
        },
      };
    </script>
  </head>

  <body
    class="bg-theme-cream text-theme-charcoal font-sans antialiased selection:bg-theme-olive"
  >
  <!-- Navbar -->
  <nav id="navbar" class="fixed w-full z-50 transition-all duration-500 py-4 px-6 md:px-12 bg-transparent">
    <div
      class="max-w-7xl mx-auto backdrop-blur-md bg-white/60 border border-white/40 rounded-2xl shadow-glass px-6 py-3 flex justify-between items-center">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-2 group">
        <img class="w-[75px]" src="/images/NJTK_Logo_full.png" alt="NJTK Logo" />
      </a>

      <!-- Desktop Menu -->
      <div class="hidden md:flex items-center space-x-8">
        <a href="#home"
          class="text-sm font-bold uppercase tracking-widest hover:text-theme-sage transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-theme-sage after:transition-all hover:after:w-full">Home</a>
        <a href="#shop"
          class="text-sm font-bold uppercase tracking-widest hover:text-theme-sage transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-theme-sage after:transition-all hover:after:w-full">Shop</a>
        <a href="/about"
          class="text-sm font-bold uppercase tracking-widest hover:text-theme-sage transition-colors relative after:content-[''] after:absolute after:-bottom-1 after:left-0 after:w-0 after:h-0.5 after:bg-theme-sage after:transition-all hover:after:w-full">About</a>
      </div>

      <!-- Icons & Mobile Button -->
      <div class="flex items-center gap-6">
        <a href="/cart" class="relative cursor-pointer group">
          <i class="fa-solid fa-bag-shopping text-xl hover:text-theme-sage transition-colors"></i>
          <span id="cart-count"
            class="absolute -top-2 -right-2 bg-theme-sage text-white text-[10px] font-bold w-5 h-5 flex items-center justify-center rounded-full group-hover:scale-110 transition-transform">0</span>
        </a>
        <!-- User Logic (EJS) -->

<% if (typeof user !== 'undefined' && user) { %>

  <!-- เมื่อ Login แล้ว -->
  <div class="hidden md:flex items-center gap-3 pl-4 border-l border-gray-300/60">

    <a href="/profile" class="flex items-center gap-2 group">
      <div class="flex flex-col">
        <span 
          class="text-xs font-bold text-gray-700 group-hover:text-theme-sage transition-colors truncate max-w-[100px]">
          <%= user.fullname %> 
        </span>

        <span class="text-[10px] text-gray-500 truncate max-w-[100px]">
          <%= user.email %>
        </span>
      </div>
    </a>

    <!-- Logout -->
    <a href="/logout"
      class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 
             hover:bg-red-50 hover:text-red-500 transition-all shadow-sm"
      title="Logout">
      <i class="fa-solid fa-arrow-right-from-bracket text-xs"></i>
    </a>
  </div>

<% } else { %>

  <!-- Guest (ไม่ได้ Login) -->
  <a href="/login"
    class="px-5 py-2 bg-theme-sage text-white text-sm rounded-full font-bold shadow-md 
           hover:bg-theme-charcoal transition-colors hidden md:inline-block">
    Login
  </a>

<% } %>

              <button id="mobile-menu-btn" class="md:hidden text-2xl focus:outline-none">
                <i class="fa-solid fa-bars-staggered"></i>
              </button>
      </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu"
      class="fixed inset-0 bg-theme-cream/95 backdrop-blur-xl z-40 transform translate-x-full transition-transform duration-300 md:hidden flex flex-col items-center justify-center space-y-8">
      <button id="close-menu" class="absolute top-8 right-8 text-3xl text-theme-sage">
        <i class="fa-solid fa-xmark"></i>
      </button>
      <a href="#home" class="text-3xl font-playfair font-bold text-theme-charcoal hover:text-theme-sage">Home</a>
      <a href="#shop" class="text-3xl font-playfair font-bold text-theme-charcoal hover:text-theme-sage">Shop</a>
      <a href="/about" class="text-3xl font-playfair font-bold text-theme-charcoal hover:text-theme-sage">About</a>
      <a href="/cart" class="text-3xl font-playfair font-bold text-theme-charcoal hover:text-theme-sage">Cart</a>
      <% if (typeof user !== 'undefined' && user) { %>
      <a href="/profile" class="text-3xl font-playfair font-bold text-theme-charcoal hover:text-theme-sage">My Profile</a>
      <a href="/logout" class="px-8 py-3 bg-theme-sage text-white rounded-full font-bold shadow-lg">Logout</a>
      <% } else { %>
        <a href="/login" class="px-8 py-3 bg-theme-sage text-white rounded-full font-bold shadow-lg">Login</a>
        <% } %>
    </div>
  </nav>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto py-20 px-6 md:px-12 max-w-7xl">
              <div class="text-center my-16 fade-in-up">
          <p
            class="text-gray-400 text-xs tracking-[0.2em] font-bold uppercase mb-2"
          >
            Your Cart Checkout
          </p>
          <h2 class="text-4xl font-playfair font-bold text-njtk-dark">
            Details & Payment
          </h2>
        </div>
      <form
        id="checkoutForm"
        onsubmit="event.preventDefault(); processPayment();"
      >
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
          <!-- LEFT COLUMN: Forms (7 Columns) -->
          <div class="lg:col-span-7 space-y-12">
            <!-- 1. Shipping Section -->
            <section>
              <div
                class="flex items-center justify-between mb-6 pb-4"
              >
                <h2 class="font-serif text-2xl text-njtk-dark">
                  Shipping Address
                </h2>
              </div>

                <div class="space-y-2">
                  <label
                    class="text-xs font-bold uppercase tracking-wider text-gray-500"
                    >First Name</label
                  >
                  <input name="fullname" 
  value="<%= user ? user.fullname : '' %>"

                    type="text"
                    class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green"
                    placeholder="First Name"
                  />
                </div>

              <div class="space-y-2 mb-6">
                <label
                  class="text-xs font-bold uppercase tracking-wider text-gray-500"
                  >Address</label
                >
                <input name="address"
                  type="text"
                  class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green"
                  placeholder="123 Sukhumvit Road, Watthana"
                />
              </div>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                  <label
                    class="text-xs font-bold uppercase tracking-wider text-gray-500"
                    >Postal Code</label
                  >
                  <input name="postal" 
                    type="text"
                    class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green"
                    placeholder="10110" maxlength="5"
                  />
                </div>
                <div class="space-y-2">
                  <label
                    class="text-xs font-bold uppercase tracking-wider text-gray-500"
                    >Phone</label
                  >
                  <input name="phone"
                    type="tel"
                    class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green"
                    placeholder="081-xxx-xxxx" maxlength="10"
                  />
                </div>
              </div>
            </section>

            <!-- 2. Payment Section -->
            <section>
              <div
                class="flex items-center justify-between mb-8 border-b border-gray-200 pb-4"
              >
                <h2 class="font-serif text-2xl text-njtk-dark">
                  Payment Method
                </h2>
                <div class="flex gap-2">
                  <i class="fa-brands fa-cc-visa text-gray-400 text-2xl"></i>
                  <i
                    class="fa-brands fa-cc-mastercard text-gray-400 text-2xl"
                  ></i>
                </div>
              </div>

              <!-- Payment Forms -->
              <div class="space-y-6">
                <div class="space-y-2">
                  <label
                    class="text-xs font-bold uppercase tracking-wider text-gray-500"
                    >Card Number</label
                  >
                  <div class="relative">
                    <input
                    name="cardNumber"
                      type="text"
                      id="inputCardNum"
                      maxlength="19"
                      class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 pl-10 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green font-sans"
                      placeholder="4242 4242 4242 4242"
                    />
                    <i
                      class="fa-regular fa-credit-card absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
                    ></i>
                  </div>
                </div>

                <div class="space-y-2">
                  <label
                    class="text-xs font-bold uppercase tracking-wider text-gray-500"
                    >Card Holder Name</label
                  >
                  <input
                  name="cardName"
                    type="text"
                    id="inputCardName"
                    class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green uppercase"
                    placeholder="NAME ON CARD"
                  />
                </div>

                <div class="grid grid-cols-2 gap-6">
                  <div class="space-y-2">
                    <label
                      class="text-xs font-bold uppercase tracking-wider text-gray-500"
                      >Expiry Date</label
                    >
                    <input
                    name="cardExp"
                      type="text"
                      id="inputCardExp"
                      maxlength="5"
                      class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green text-center"
                      placeholder="MM/YY"
                    />
                  </div>
                  <div class="space-y-2">
                    <label
                      class="text-xs font-bold uppercase tracking-wider text-gray-500"
                      >CVV</label
                    >
                    <div class="relative">
                      <input name="cardCvv"
                        type="text"
                        id="inputCardCvv"
                        maxlength="3"
                        class="input-field w-full bg-white border border-gray-200 rounded px-4 py-3 focus:outline-none focus:border-njtk-green focus:ring-1 focus:ring-njtk-green text-center"
                        placeholder="123"
                      />
                      <i
                        class="fa-solid fa-lock absolute right-3 top-1/2 -translate-y-1/2 text-gray-300 text-xs"
                      ></i>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>

          <!-- RIGHT COLUMN: Order Summary (5 Columns) -->
          <div class="lg:col-span-5">
            <div
              class="bg-white rounded-xl shadow-lg p-6 lg:p-8 sticky top-24 border border-gray-100"
            >
              <h3 class="font-playfair text-xl mb-6 text-njtk-dark">
                Order Summary
              </h3>

              <% if (cart && cart.length > 0) { %> <%
              cart.forEach(function(item, index) { %>

              <div
                class="flex gap-4 mb-6 <%= index === cart.length - 1 ? 'border-b border-gray-100 pb-6' : '' %>"
              >
                <div class="w-16 h-24 flex-shrink-0 relative shadow-sm">
                  <img
                    src="<%= item.imageURL %>"
                    alt="Book"
                    class="w-full h-full object-cover rounded-sm"
                  />
                </div>
                <div class="flex-grow flex flex-col justify-between">
                  <div class="item-info">
                    <h4>item.bookname</h4>
                    <p class="text-sm font-semibold">
                      Quantity: <%= item.qty %>
                    </p>
                    <p class="text-sm font-semibold">
                      ฿<%= item.total.toLocaleString("th-TH") %>
                    </p>
                  </div>
                </div>
              </div>
              <% }); %> <% } else { %>
              <p class="text-sm text-gray-500 mb-6">
                ยังไม่มีสินค้าในคำสั่งซื้อ
              </p>
              <% } %>

              <!-- Calculations -->
              <div class="space-y-3 text-sm text-gray-600 mb-6">
                <div class="flex justify-between">
                  <span>Subtotal</span>
                  <span>฿<%= subtotal.toLocaleString("th-TH") %></span>
                </div>
                <div class="flex justify-between">
                  <span>Shipping (Standard)</span>
                  <span>฿<%= shipping.toLocaleString("th-TH") %></span>
                </div>
              </div>

              <!-- Total -->
              <div
                class="flex justify-between items-center pt-6 border-t border-gray-200 mb-8"
              >
                <span class="font-playfair text-lg text-njtk-dark font-bold"
                  >Total</span
                >
                <div class="text-right">
                  <span class="font-playfair text-2xl font-bold text-njtk-dark">
                    ฿<%= grandTotal.toLocaleString("th-TH") %>
                  </span>
                </div>
              </div>

              <!-- Button -->
              <button onclick="checkout()"
                type="submit"
                id="btnPay"
                class="w-full bg-theme-sage text-white font-medium py-4 px-6 rounded-lg shadow-md hover:bg-[#5D7A60] hover:shadow-lg transition-all transform active:scale-95 flex items-center justify-center gap-2 group"
              >
                <span>Pay Now</span>
                <i
                  class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"
                ></i>
              </button>

              <div class="mt-4 text-center">
                <p class="text-[10px] text-gray-400">
                  <i class="fa-solid fa-lock mr-1"></i> Secure Encrypted Payment
                </p>
              </div>
            </div>
          </div>
        </div>
      </form>
    </main>
    <!-- JavaScript Logic -->
    <script src="/javascripts/navbar.js"></script>
    <script src="/javascripts/scrollbar.js"></script>
    <script src="/javascripts/cart.js"></script>
    <script src="/javascripts/info.js"></script>
  </body>
</html>
